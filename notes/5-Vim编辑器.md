# 5-Vim编辑器

## 1. vim主要模式介绍

* 查询命令安装位置：rpm -qf `which vim` ； rpm -qf `which vi`。vim是vi的增加版，最明显的区别就是vim可以语法加亮，它完全兼容vi

* 主要模式有4种
1. 命令模式  默认
2. 扩展命令行模式 ':'进入，'enter'退出
3. 编辑模式，文件底部会出现Insert字样 'a/i/o/A/I/O'进入，'esc'退出
4. 虚拟编辑(可视块)模式 ，文件底部会出现Visual字样 'vV^v'切换进出

* vim打开多个文档
1. vim -O 文件1 文件2 左右显示(CTRL+ww切换当前编辑屏幕)
2. vim -o 文件1 文件2 上下显示

* 对比文件
1. diff 文件1 文件2
2. vimdiff 文件1 文件2
3. :qa 退出所有多个文件

## 2. 命令模式

* 光标定位：
1. HJKL(上左右下)
2. 0 和 home键表示切换到行首， $和end键表示切换到行尾
3. gg 快速定位到文档的首行 ,  G定位到未行
4. 3gg 或者 3G  快速定位到第3行
5. /string(字符串)   ----找到或定位要找的单词或内容，如果相符内容比较多，可以通过N、n来进行向上向下查找，取消高亮显示 :noh
6. /^d  ----^意思表示以什么开头 ，，查找以字母d开头的内容
7. /t$  ----$意思表示以什么结尾，，查找以字母t结尾的内容
8. vim + a.txt  打开文件后，光标会自动位于文件的最后一行

* 文本编辑 删除、剪切、复制、粘贴、撤销
1. y 复制（以字符为单位） :表示对单个字符进行复制，如果要复制整行，用yy（以行为单位）,复制N行： Nyy  ，比如： 2yy ，表示复制2行
2. dd（删除，以行为单位，删除当前光标所在行）,删除N行： Ndd  ，比如： 2dd ，表示删除2行
3. p ： P粘贴,剪切： dd
4. x 删除光标所在位置的字符
5. D 从光标处删除到行尾
6. u 撤销操作
7. ctrl+r  还原撤销过的操作，将做过的撤销操作再还原回去，也就是说撤销前是什么样，再还原成什么样
8. r 替换，或者说用来修改一个字符

## 3. 扩展命令行模式

* 常用操作：
1. :w 保存 save
2. :w! 强制保存
3. :q 没有进行任何修改，退出 quit
4. :q! 修改了，不保存，强制退出
5. :wq 保存并退出
6. :wq! 强制保存并退出 (编辑/etc/shadow文件需要用到)
7. :x 保存退出

* 调用外部文件或命令
1. 调用系统命令:!ifconfig
2. 读取其他文件。（把其他文件中的内容追加到当前文档中）:r /etc/hosts

* 文本替换，语法：范围(%表示所有内容) S(替换)/bin(匹配的内容)/hhhhhh(替换的新内容)
1. 默认是每一行的第一个符合要求的词   (/g-全部,i-不区分大小写)
2. :1,3 s/bin/hhhhhhh    替换第1到3行中出现的每行第一个bin进行替换为hhhhhhh
3. :1,3 s/bin/hhhhhhh/g  替换第1到3行中查找到所有的bin进行替换为hhhhhhh
4. :3 s/xue/aaaaa        只把第3行中内容替换了
5. :% s/do/hhhhhhh/g     将文本中所有的do替换成hhhhhhh
6. :% s/do/hhhhhhh/gi    将文本中所有的do替换成hhhhhhh, 并且忽略do的大小写
7. :% s@a@b@g            将文本中所有的a替换成b

## 4. 编辑模式

* 进入编辑模式的方法:
1. i 当前字符之前插入 (光标前)
2. I 行首插入  (行首)
3. a 当前字符之后插入 (光标后)
4. A 行尾插入(行尾)
5. o下一行插入 (另起一行)
6. O上一行插入(上一行插入)
7. x 向后删除一个字符，等同于delete
8. X 向前删除一个字符，等同于backspace
9. u 撤销一步   每按一次就撤销一次
10. r 替换

## 5. 虚拟编辑(可视块)模式

* 进入方法V可视/CTRL+V可视块，移动光标选择区域

* 多行编辑：
1. CTRL+V 进入列编辑模式
2. 向上或下移动光标，选中要编辑的行头
3. 大写I插入
4. 输入要在行头加入的字符
5. ESC退出可视块模式，等1秒完成

* 多行删除只要在列编辑模式下选中内容然后d即可

## 6. Vim设置编辑环境

* 临时设置
1. 设置/取消行号 :set nu / :set nonu
2. 取消高亮显示 :noh
3. 自动缩进 :set ai

* 永久设置，生成配置文件保存起来
1. vim /etc/vimrc 设置后影响系统所有的用户
2. vim ~/.vimrc 在用户目录下创建.vimrc,只影响当前用户(建议在用户下设置)

## 7. 利用xshell进行linux虚拟机与windows本机的文件交换

* 在xshell终端中 rz 文件名 (虚拟机从本机中read读取)
* 在xshell终端中 sz 文件名 (虚拟机向本机send发送)
* 在xshell终端中 gnome-terminal/firefox 等等 可以直接调起图形化界面的程序

## 8. 解决window汉字文件在linux中乱码

* 原因：编码的问题

* 通过iconv命令转码，参数：
1. -f, --from-code=名称 原始文本编码
2. -t, --to-code=输出编码
3. -o, --output=FILE 输出文件名
4. iconv -f gb2312 -t utf8 (文件) -o aa.txt

## 9. 解决linux文件在windows上打开串行

* 原因：windows和linux处理回车方法不同

* 使用工具dos2unix进行转换
1. rpm -ivh /mnt/Packages/dos2unix-6.0.3-7.el7.x86_64.rpm (安装工具)
2. unix2dos 文件名 (转换)
3. sz 文件名 (发送)

## 10. 恢复误删除的文件

* rm -rf /* 可以删除根目录下的所有文件，很危险！

* ext4文件系统上删除文件，可以恢复: extundelete ，ext3恢复使用：ext3grep

* windows恢复误删除的文件：  final data v2.0 汉化版  和  easyrecovery
