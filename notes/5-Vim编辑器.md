# 5-Vim编辑器

## 1. vim主要模式介绍

* 查询命令安装位置：rpm -qf `which vim` ； rpm -qf `which vi`。vim是vi的增加版，最明显的区别就是vim可以语法加亮，它完全兼容vi

* 主要模式有4种
1. 命令模式  默认
2. 扩展命令行模式 ':'进入，'enter'退出
3. 编辑模式，文件底部会出现Insert字样 'a/i/o/A/I/O'进入，'esc'退出
4. 虚拟编辑(可视块)模式 ，文件底部会出现Visual字样 'vV^v'切换进出

* vim打开多个文档
1. vim -O 文件1 文件2 左右显示(CTRL+ww切换当前编辑屏幕)
2. vim -o 文件1 文件2 上下显示

* 对比文件
1. diff 文件1 文件2
2. vimdiff 文件1 文件2
3. :qa 退出所有多个文件

## 2. 命令模式

* 光标定位：
1. HJKL(上左右下)
2. 0 和 home键表示切换到行首， $和end键表示切换到行尾
3. gg 快速定位到文档的首行 ,  G定位到未行
4. 3gg 或者 3G  快速定位到第3行
5. /string(字符串)   ----找到或定位要找的单词或内容，如果相符内容比较多，可以通过N、n来进行向上向下查找，取消高亮显示 :noh
6. /^d  ----^意思表示以什么开头 ，，查找以字母d开头的内容
7. /t$  ----$意思表示以什么结尾，，查找以字母t结尾的内容
8. vim + a.txt  打开文件后，光标会自动位于文件的最后一行

* 文本编辑 删除、剪切、复制、粘贴、撤销
1. y 复制（以字符为单位） :表示对单个字符进行复制，如果要复制整行，用yy（以行为单位）,复制N行： Nyy  ，比如： 2yy ，表示复制2行
2. dd（删除，以行为单位，删除当前光标所在行）,删除N行： Ndd  ，比如： 2dd ，表示删除2行
3. p ： P粘贴,剪切： dd
4. x 删除光标所在位置的字符
5. D 从光标处删除到行尾
6. u 撤销操作
7. ctrl+r  还原撤销过的操作，将做过的撤销操作再还原回去，也就是说撤销前是什么样，再还原成什么样
8. r 替换，或者说用来修改一个字符

## 3. 扩展命令行模式

* 常用操作：
1. :w 保存 save
2. :w! 强制保存
3. :q 没有进行任何修改，退出 quit
4. :q! 修改了，不保存，强制退出
5. :wq 保存并退出
6. :wq! 强制保存并退出 (编辑/etc/shadow文件需要用到)
7. :x 保存退出

* 调用外部文件或命令
1. 调用系统命令:!ifconfig
2. 读取其他文件。（把其他文件中的内容追加到当前文档中）:r /etc/hosts

* 文本替换，语法：范围(%表示所有内容) S(替换)/bin(匹配的内容)/hhhhhh(替换的新内容)
1. 默认是每一行的第一个符合要求的词   (/g-全部,i-不区分大小写)
2. :1,3 s/bin/hhhhhhh    替换第1到3行中出现的每行第一个bin进行替换为hhhhhhh
3. :1,3 s/bin/hhhhhhh/g  替换第1到3行中查找到所有的bin进行替换为hhhhhhh
4. :3 s/xue/aaaaa        只把第3行中内容替换了
5. :% s/do/hhhhhhh/g     将文本中所有的do替换成hhhhhhh
6. :% s/do/hhhhhhh/gi    将文本中所有的do替换成hhhhhhh, 并且忽略do的大小写
7. :% s@a@b@g            将文本中所有的a替换成b

## 4. 编辑模式

* 进入编辑模式的方法:
1. i 当前字符之前插入 (光标前)
2. I 行首插入  (行首)
3. a 当前字符之后插入 (光标后)
4. A 行尾插入(行尾)
5. o下一行插入 (另起一行)
6. O上一行插入(上一行插入)
7. x 向后删除一个字符，等同于delete
8. X 向前删除一个字符，等同于backspace
9. u 撤销一步   每按一次就撤销一次
10. r 替换

## 5. 虚拟编辑(可视块)模式

* 进入方法V可视/CTRL+V可视块，移动光标选择区域

* 多行编辑：
1. CTRL+V 进入列编辑模式
2. 向上或下移动光标，选中要编辑的行头
3. 大写I插入
4. 输入要在行头加入的字符
5. ESC退出可视块模式，等1秒完成

* 多行删除只要在列编辑模式下选中内容然后d即可

## 6. Vim设置编辑环境

* 临时设置
1. 设置/取消行号 :set nu / :set nonu
2. 取消高亮显示 :noh
3. 自动缩进 :set ai

* 永久设置，生成配置文件保存起来
1. vim /etc/vimrc 设置后影响系统所有的用户
2. vim ~/.vimrc 在用户目录下创建.vimrc,只影响当前用户(建议在用户下设置)

## 7. 利用xshell进行linux虚拟机与windows本机的文件交换

* 在xshell终端中 rz 文件名 (虚拟机从本机中read读取)
* 在xshell终端中 sz 文件名 (虚拟机向本机send发送)
* 在xshell终端中 gnome-terminal/firefox 等等 可以直接调起图形化界面的程序

## 8. 解决window汉字文件在linux中乱码

* 原因：编码的问题

* 通过iconv命令转码，参数：
1. -f, --from-code=名称 原始文本编码
2. -t, --to-code=输出编码
3. -o, --output=FILE 输出文件名
4. iconv -f gb2312 -t utf8 (文件) -o aa.txt

## 9. 解决linux文件在windows上打开串行

* 原因：windows和linux处理回车方法不同

* 使用工具dos2unix进行转换
1. rpm -ivh /mnt/Packages/dos2unix-6.0.3-7.el7.x86_64.rpm (安装工具)
2. unix2dos 文件名 (转换)
3. sz 文件名 (发送)

## 10. 恢复误删除的文件

* rm -rf /* 可以删除根目录下的所有文件，很危险！

* ext4文件系统上删除文件，可以恢复: extundelete ，ext3恢复使用：ext3grep

* windows恢复误删除的文件：  final data v2.0 汉化版  和  easyrecovery

## 11. Vima快捷键总结

### 11.1 插入模式

* 进入插入模式
1. i: 插入光标前一个字符
2. I: 插入行首
3. a: 插入光标后一个字符
4. A: 插入行未
5. o: 向下新开一行,插入行首
6. O: 向上新开一行,插入行首

### 11.2 命令模式

* 进入命令模式:ESC:从插入模式或末行模式进入命令模式

* 移动光标:
1. h: 左移
2. j: 下移
3. k: 上移
4. l: 右移
5. M: 光标移动到中间行
6. L: 光标移动到屏幕最后一行行首
7. G: 移动到指定行,行号 -G
8. w: 向后一次移动一个字
9. b: 向前一次移动一个字
10. {: 按段移动,上移
11. }: 按段移动,下移
12. Ctr-d: 向下翻半屏
13. Ctr-u: 向上翻半屏
14. Ctr-f: 向下翻一屏
15. Ctr-b: 向上翻一屏
16. gg: 光标移动文件开头
17. G: 光标移动到文件末尾

* 删除命令:
1. x: 删除光标后一个字符,相当于 Del
2. X: 删除光标前一个字符,相当于 Backspace
3. dd: 删除光标所在行,n dd 删除指定的行数 D: 删除光标后本行所有内容,包含光标所在字符
4. d0: 删除光标前本行所有内容,不包含光标所在字符
5. dw: 删除光标开始位置的字,包含光标所在字符

* 撤销命令:
1. u: 一步一步撤销
2. Ctr-r: 反撤销

* 重复命令:  .: 重复上一次操作的命令

* 文本行移动:
1. >>: 文本行右移
2. <<: 文本行左移

* 复制粘贴:
1. yy: 复制当前行,n yy 复制 n 行
2. p: 在光标所在位置向下新开辟一行,粘贴

### 11.3 可视模式

* 进入可视模式:
1. v: 按字符移动,选中文本
2. V: 按行移动,选中文本可视模式可以配合 d, y, >>, << 实现对文本块的删除,复制,左右移动

* 替换操作:
1. r: 替换当前字符
2. R: 替换当前行光标后的字符

* 查找命令:
1. /: str查找
2. n: 下一个
3. N：上一个

* 替换命令：把abc全部替换成123
1. 末行模式下，将光标所在行的abc替换成123  :%s/abc/123/g
2. 末行模式下，将第一行至第10行之间的abc替换成123  :1, 10s/abc/123/g

* vim里执行 shell 下命令: 末行模式里输入!,后面跟命令

### 11.4 vim分屏操作

* 分屏操作:
1. sp: 上下分屏,后可跟文件名
2. vsp: 左右分屏,后可跟文件名
3. Ctr+w+w: 在多个窗口切换

* 启动分屏:

1. 使用大写O参数进行垂直分屏  $ vim -On file1 file2 ...
2. 使用小写o参数进行水平分屏  $ vim -on file1 file2 ...
3. 注: n是数字，表示分屏的数量,n要大于等于文件个数

* 关闭分屏
1. 关闭当前窗口  ctrl+w c
2. 关闭当前窗口，如果只剩最后一个，则退出vim  ctrl+w q

* 编辑中分屏
1. 上下分割当前打开的文件  ctrl+w s
2. 上下分割，并打开一个新的文件  :sp filename
3. 左右分割当前打开的文件  ctrl+w v
4. 左右分割，并打开一个新的文件  :vsp filename

* 分屏编辑中光标的移动
1. vi中的光标键是h,j,k,l,要在各个屏之间切换，只需要先按一下ctrl+w
2. 把光标移动到上边的屏  ctrl+w k
3. 把光标移动到下边的屏  ctrl+w j
4. 把光标移动到右边的屏  ctrl+w l
5. 把光标移动到左边的屏  ctrl+w h
6. 把光标移动到下一个的屏  ctrl+w w

* 移动分屏
1. 向上移动  ctrl+w K
2. 向下移动  ctrl+w J
3. 向右移动  ctrl+w L
4. 向左移动  ctrl+w H

* 屏幕尺寸
1. 增加高度  ctrl+w +
2. 减少高度  ctrl+w -
3. 让所有屏的高度一致  ctrl+w =
4. 左加宽度  ctrl+w >
5. 右加宽度  ctrl+w <
6. 右增加n宽 (如：n=30)  ctrl+w n <

### 11.5 vim打造IDE

* 简洁版IDE
1. C+p: 生成tags
2. C+]: 跳转到函数定义
3. C+t：从函数定义返回
4. C+o：在左侧打开文件列表
5. F4:  在右侧打开函数列表
6. C+n：补齐函数，向下翻

* vimrc是vim的配置文件，可以修改两个位置
1. /etc/vim/vimrc
2. ~/.vimrc
3. ~/.vimrc优先级高